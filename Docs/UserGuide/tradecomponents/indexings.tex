\subsubsection{Indexings}
\label{ss:indexings}

This trade component can be used as an optional node within the LegData component to scale the notional of the coupons
of a leg by one or several index prices. This feature is typically used within equity swaps with notional reset to align
the notional of the funding leg with the one from the equity leg for all return periods. See \ref{ss:equity_swap} for
the specific usage in equity swaps. Notice that typically it is sufficient to set the FromAssetLeg flag to true in the
\verb+Indexings+ node definition, i.e.

\begin{minted}[fontsize=\footnotesize]{xml}
<LegData>
    <LegType>Floating</LegType>
    <!-- no notionals node required -->
    <ScheduleData> ... </ScheduleData>
    <Indexings>
        <FromAssetLeg>true</FromAssetLeg>
    </Indexings>
    <FloatingLegData> ... </FloatingLegData>
</LegData>
\end{minted}

which will cause the trade builder to pull all the indexing details from the asset leg (the equity leg in an equity
swap) and populate the indexing data on the funding leg accordingly. Notice that no definition of a \verb+Notionals+
node is required in this case, this will also generated automatically.

In what follows we will describe the full syntax of the Indexings node below for reference. The Indexing component can
be used in combination with the following leg types:

\begin{itemize}
\item Fixed
\item Floating
\item CMS
\item CMSSpread
\item DigitalCMSSpread
\end{itemize}

If specified the notional of the single coupons in the leg is scaled by one or several index prices and a quantity. The
indices can be equity or FX indices. Notice that if notional exchanges are enabled on a leg with Indexings defined, the
notional exchanges are {\em not} influenced by the indexing definitions. In general we assume that notional exchanges
are not enabled in combination with indexings, but it is not forbidden technically. Listing \ref{lst:indexings} shows an
example of an Floating leg indexed by both an equity price and a FX rate.

\begin{listing}[H]
%\hrule\medskip
\begin{minted}[fontsize=\footnotesize]{xml}
<LegData>
    <LegType>Floating</LegType>
    <Notionals> ... </Notionals>
    <ScheduleData> ... </ScheduleData>
    <Indexings>
        <FromAssetLeg>false</FromAssetLeg>
        <Indexing>
            <Quantity>1000</Quantity>
            <Index>EQ-RIC:.STOXX50E</Index>
            <InitialFixing>2937.36</InitialFixing>
            <ValuationSchedule>
              <Dates>...</Dates>
              <Rules>...</Rules>
            </ValuationSchedule>
            <FixingDays>0</FixingDays>
            <FixingCalendar/>
            <FixingConvention>U</FixingConvention>
            <IsInArrears>false</IsInArrears>
        </Indexing>
        <Indexing>
            <Index>FX-ECB-EUR-USD</Index>
            <IndexFixingDays>2</IndexFixingDays>
            <IndexFixingCalendar>EUR,USD</IndexFixingCalendar>
            <InitialFixing>1.1469</InitialFixing>
            <ValuationSchedule> ... </ValuationSchedule>
            <FixingDays>0</FixingDays>
            <FixingCalendar/>
            <FixingConvention>U</FixingConvention>
            <IsInArrears>false</IsInArrears>
        </Indexing>
    </Indexings>
    <FloatingLegData> ... </FloatingLegData>
</LegData>
\end{minted}
\caption{Indexings node}
\label{lst:indexings}
\end{listing}

The Indexings node contains the following elements:

\begin{itemize}
\item FromAssetLeg [Optional, defaults to false]: If true and the trade type supports this (e.g. equity swap) the trade
  builder will add \verb+Indexing+ blocks automatically reflecting the necessary indexings (equity price and FX in the
  case of an equity swap) from the notional reset feature of the asset leg. Also, the Notionals node of the leg will be
  set to a single notional $1$.
\item Indexing [Optional, an arbitrary number can be given]: Each Indexing node describes one indexing as follows:

\begin{itemize}

\item Quantity [Optional, defaults to 1]: The quantity that applies. For equity that should be the number of shares, for
  FX it should be 1, i.e. for FX this field can be omitted. The notional of each coupon is
  in general determined as\\
  Original Coupon Notional x Quantity x Equity Price x FX Rate\\
  depending on which indexing types are given. Typically, the original coupon notional will be set to 1.

  Allowable values: any number.

\item Index: The relevant index. This is either an equity or FX index. For an FX index, one of the currencies of the
  index must match the leg currency. It is then ensured that the FX conversion is applied using the correct direction,
  i.e. if the foreign currency of the index matches the leg currency, the reciprocals of the index fixings are used as a
  multiplier.

  Allowable values: This is ``FX-SOURCE-CCY1-CCY'' for FX, see \ref{ss:underlying} and \ref{tab:fxindex_data} for
  details, or ``EQ-NAME'' for Equity with ``Name'' being the general string representation for equity underlyings
  {IdentifierType}:{Name}:{Currency}:{Exchange}, see \ref{ss:underlying}.

\item IndexFixingDays [Optional, defaults to 0]: fixing days of the index, this is only used for FX indices

  Allowable values: non-negative whole number

\item IndexFixingCalendar [Optional, defaults to NullCalendar (no holidays)]: fixing calendar of the index, this is only
  used for FX indices and Bond indices

  Allowable values: any valid calendar

\item Dirty [Optional, defaults to true]: Only used for bond indices. Indicates whether to use dirty (true) or clean
  (false) prices.

  Allowable values: true, false

\item Relative [Optional, defaults to true]: Only used for bond indices. Indicates whether to use relative (true) or
  absolute prices (false).

  Allowable values: true, false

\item ConditionalOnSurvival [Optional, defaults to true]: Only used for bond indices. Indicates whether to forecast bond
  prices conditional on survival (true) or including the default probability from today until the fixing date (false).

  Allowable values: true, false

\item InitialFixing [Optional]: If given the index fixing value to apply on the fixing date of the first coupon. If not
  given the value is read from the relevant fixing history.

  Allowable values: any number

\item ValuationSchedule [Optional]: If given the schedule from which the fixing dates are deduced. If not given, it
  defaults to the original leg's schedule. The $i$th fixing date is derived from the $i$th (inArrears = false) or
  $i+1$th (inArrears = true) date in the valuation schedule using the FixingDays, FixingCalendar and FixingConvention.

  Allowable values: a valid schedule definition, see \ref{ss:schedule_data}

\item FixingDays [Optional, defaults to 0]: If given defines the number of fixing days to apply when deriving the fixing
  dates from the valuation schedule (see above).

  Allowable values: any non-negative whole number

\item FixingCalendar [Optional, defaults to NullCalendar (no holidays): If given defines the fixing calendar to use when
  deriving the fixing dates from the valuation schedule (see above).

  Allowable values: any valid calendar

\item FixingConvention [Optional, defaults to Preceding]: If given defines the business day convention to use when
  deriving the fixing dates from the valuation schedule (see above).

  Allowable values: any valid business day convention (F, MF, P, MP, U)

\item IsInArrears [Optional, defaults to false]: If true, the fixing dates are derived from the period end dates,
  otherwise from the period start dates as described for ValuationSchedule above.

  Allowable values: true, false

\end{itemize}

\end{itemize}
