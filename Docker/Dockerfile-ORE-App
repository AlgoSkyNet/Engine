ARG ore_version=latest
ARG debian_tag=latest

FROM env_ore:${ore_version} as env_ore

FROM debian:${debian_tag}

#we update to a UK debian mirror. This is from https://www.debian.org/mirror/sponsors.html
RUN echo \
   'deb http://ukdebian.mirror.anlx.net/debian stable main contrib non-free\n \
    deb-src http://ukdebian.mirror.anlx.net/debian stable main contrib non-free\n \
    deb-src http://ukdebian.mirror.anlx.net/debian stable-updates main contrib non-free\n' \
    > /etc/apt/sources.list


COPY Examples /ore/Examples

RUN mkdir /ore/App
COPY --from=env_ore /usr/local/bin /ore/App
RUN true
COPY --from=env_ore /usr/local/lib /usr/local/lib

# Install Python solely to run the examples
# Can leave out Python and run examples manually for slimmer image
RUN apt-get update \
  && DEBIAN_FRONTEND=noninteractive apt-get install -y dos2unix python3 python3-pip \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/*

RUN pip3 install matplotlib pandas

# For the examples to work, input txt files need unix line endings
RUN cd /ore/Examples && find -regex ".*\.\(sh\|txt\)" -exec dos2unix {} ';'

WORKDIR /ore/Examples/Example_1

CMD bash
